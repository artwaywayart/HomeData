<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏≠‡∏õ‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</title><!-- Favicon -->
  <link rel="icon" type="image/png" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="shortcut icon" type="image/png" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V"><!-- Apple Touch Icons for iOS -->
  <link rel="apple-touch-icon" sizes="57x57" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="60x60" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="72x72" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="76x76" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="114x114" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="120x120" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="144x144" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="152x152" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V">
  <link rel="apple-touch-icon" sizes="180x180" href="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V"><!-- Apple Touch Icon Title for iOS -->
  <meta name="apple-mobile-web-app-title" content="‡πÅ‡∏≠‡∏õ‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô"><!-- PWA Meta Tags -->
  <meta name="application-name" content="‡πÅ‡∏≠‡∏õ‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô">
  <meta name="theme-color" content="#3b82f6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="mobile-web-app-capable" content="yes"><!-- Web App Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuC5geC4reC4m+C4nOC5iOC4reC4meC4muC5ieC4suC4mSIsCiAgInNob3J0X25hbWUiOiAi4LmB4Lit4Lib4Lic4LmI4Lit4LiZ4Lia4LmJ4Liy4LiZIiwKICAiZGVzY3JpcHRpb24iOiAi4Lij4Liw4Lia4Lia4LiV4Li04LiU4LiV4Liy4Lih4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lil4Liw4LiB4Liy4Lij4LiK4Liz4Lij4Liw4LmA4LiH4Li04LiZ4LiC4Lit4LiH4LiB4Liy4Lij4LiC4Liy4Lii4Lia4LmJ4Liy4LiZIiwKICAic3RhcnRfdXJsIjogIi4vIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQtcHJpbWFyeSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiLAogICJjYXRlZ29yaWVzIjogWyJmaW5hbmNlIiwgInV0aWxpdGllcyJdLAogICJsYW5nIjogInRoIiwKICAic2NvcGUiOiAiLi8iLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/ZXhwb3J0PWRvd25sb2FkJmlkPTF3cEdwYzBNQ3RIYnAzZmQzVUlKVkNib1QtN3N4eTRWIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9MXdwR3BjME1DdEhicDNmZDNVSUpWQ2JvVC03c3h5NFYiLAogICAgICAic2l6ZXMiOiAiMjU2eDI1NiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIsCiAgICAgICJwdXJwb3NlIjogImFueSIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD0xd3BHcGMwTUN0SGJwM2ZkM1VJSlZDYm9ULTdzeHk0ViIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwKICAgICAgInB1cnBvc2UiOiAiYW55IgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/ZXhwb3J0PWRvd25sb2FkJmlkPTF3cEdwYzBNQ3RIYnAzZmQzVUlKVkNib1QtN3N4eTRWIiwKICAgICAgInNpemVzIjogIjE0NHgxNDQiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkiCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9MXdwR3BjME1DdEhicDNmZDNVSUpWQ2JvVC03c3h5NFYiLAogICAgICAic2l6ZXMiOiAiOTZ4OTYiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkiCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9MXdwR3BjME1DdEhicDNmZDNVSUpWQ2JvVC03c3h5NFYiLAogICAgICAic2l6ZXMiOiAiNzJ4NzIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkiCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9MXdwR3BjME1DdEhicDNmZDNVSUpWQ2JvVC03c3h5NFYiLAogICAgICAic2l6ZXMiOiAiNDh4NDgiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkiCiAgICB9CiAgXQp9"><!-- iOS Safari PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-touch-fullscreen" content="yes"><!-- Android PWA Support -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#3b82f6">
  <meta name="msapplication-TileImage" content="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V"><!-- iOS Safari PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-touch-fullscreen" content="yes"><!-- Android PWA Support -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#3b82f6">
  <meta name="msapplication-TileImage" content="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V"><!-- Viewport for mobile optimization -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Kanit', sans-serif; 
            box-sizing: border-box;
        }
        .progress-bar {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.5s ease-in-out;
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .modal-backdrop {
            backdrop-filter: blur(5px);
        }
        
        /* Theme Styles */
        .theme-blue {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .theme-green {
            background: linear-gradient(135deg, #586d72 0%, #4a5d62 100%);
        }
        
        .theme-purple {
            background: linear-gradient(135deg, #8e8ec2 0%, #7c7cb8 100%);
        }
        
        .theme-yellow {
            background: linear-gradient(135deg, #ffdb00 0%, #fbbf24 100%);
        }
        
        .theme-red {
            background: linear-gradient(135deg, #dd2b2b 0%, #b91c1c 100%);
        }
        
        .theme-cyan {
            background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);
        }
        
        .theme-darkblue {
            background: linear-gradient(135deg, #0050f0 0%, #003bb8 100%);
        }
        
        /* Inactive button styles */
        .btn-inactive {
            opacity: 0.4;
            transition: opacity 0.3s ease;
        }
        
        .btn-inactive:hover {
            opacity: 0.7;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full"><!-- Top Controls (Hidden - moved to settings menu) -->
  <div class="hidden"><!-- Theme Toggle --> <button id="themeToggle" onclick="showThemeSelector()" class="bg-gray-600 hover:bg-gray-700 text-white p-2 sm:p-3 rounded-md sm:rounded-lg text-xs sm:text-sm transition-colors"> <i class="fas fa-palette text-xs sm:text-sm"></i> </button> <!-- Login Button --> <button id="loginBtn" onclick="showLoginModal()" class="bg-gray-600 hover:bg-gray-700 text-white p-2 sm:p-3 rounded-md sm:rounded-lg text-xs sm:text-sm transition-colors"> <i class="fas fa-user text-xs sm:text-sm"></i> </button> <!-- Admin Buttons -->
   <div id="adminButtons" class="hidden flex space-x-1.5 sm:space-x-2"><button onclick="backToAdmin()" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1.5 sm:px-3 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm transition-colors"> <i class="fas fa-arrow-left text-xs sm:text-sm"></i> </button> <button onclick="showMainPage()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1.5 sm:px-3 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm transition-colors"> <i class="fas fa-home text-xs sm:text-sm"></i> </button> <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1.5 sm:px-3 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm transition-colors"> <i class="fas fa-sign-out-alt text-xs sm:text-sm"></i> </button>
   </div>
  </div><!-- Main Content -->
  <div id="mainContent" class="container mx-auto px-3 py-6 max-w-sm sm:max-w-md sm:px-4 sm:py-8"><!-- Card 1: Loan Summary -->
   <div class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 mb-4 sm:mb-6 card-shadow relative"><input type="file" id="profileImageInput" accept="image/*" class="hidden"> <!-- Profile Icon - Top Left of Card -->
    <div class="absolute top-3 left-3 sm:top-4 sm:left-4 z-10">
     <div class="bg-blue-100 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center relative overflow-hidden cursor-pointer shadow-lg hover:shadow-xl transition-all duration-200" onclick="showIconSelector()"><img id="profileImageTop" src="https://drive.google.com/uc?export=download&amp;id=1wpGpc0MCtHbp3nfd3UIJVCboT-7sxy4V" alt="‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" class="w-full h-full object-cover rounded-full" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'48\' fill=\'%23dbeafe\' stroke=\'%233b82f6\' stroke-width=\'2\'/%3E%3Ctext x=\'50\' y=\'60\' text-anchor=\'middle\' font-size=\'35\' fill=\'%233b82f6\'%3Eüè†%3C/text%3E%3C/svg%3E';">
      <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-200 rounded-full flex items-center justify-center"><i class="fas fa-edit text-white opacity-0 hover:opacity-100 transition-opacity duration-200 text-xs"></i>
      </div>
     </div>
    </div><!-- Settings Button - Top Right of Card -->
    <div class="absolute top-3 right-3 sm:top-4 sm:right-4 z-10">
     <div class="relative"><button id="settingsBtn" onclick="toggleSettingsMenu()" class="bg-gray-100 hover:bg-gray-200 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200"> <i class="fas fa-cog text-gray-600 text-sm sm:text-base"></i> </button> <!-- Settings Dropdown Menu -->
      <div id="settingsMenu" class="absolute top-12 right-0 bg-white rounded-xl shadow-xl border border-gray-200 py-2 w-48 hidden z-20"><!-- Install App Button --> <button id="installAppBtn" onclick="installPWA(); hideSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center hidden"> <i class="fas fa-download text-purple-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</span> </button>
       <div id="installDivider" class="border-t border-gray-100 my-1 hidden"></div><button onclick="showThemeSelector(); hideSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-palette text-blue-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡∏™‡∏µ</span> </button>
       <div class="border-t border-gray-100 my-1"></div><button id="loginMenuBtn" onclick="showLoginModal(); hideSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-user text-green-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span> </button> <!-- Admin Menu Items (hidden by default) -->
       <div id="adminMenuItems" class="hidden">
        <div class="border-t border-gray-100 my-1"></div><button onclick="showMainPage(); hideSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-home text-green-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span> </button> <button onclick="showAdminPanel(); hideSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-clipboard-check text-purple-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span> </button>
        <div class="border-t border-gray-100 my-1"></div><button onclick="logout(); hideSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-sign-out-alt text-red-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span> </button>
       </div>
      </div>
     </div>
    </div><!-- Circular Progress Ring -->
    <div class="flex justify-center mb-6 sm:mb-8 mt-4 sm:mt-6">
     <div class="relative w-60 h-60 sm:w-72 sm:h-72"><!-- Background Circle -->
      <svg class="w-full h-full transform -rotate-90" viewbox="0 0 120 120"><!-- Main background circle --> <circle cx="60" cy="60" r="50" stroke="#e2e8f0" stroke-width="4" fill="none" /> <!-- Inner shadow for depth --> <circle cx="60" cy="60" r="46" stroke="#f8fafc" stroke-width="2" fill="none" opacity="0.8" /> <!-- Progress circle with full circumference --> <circle id="progressCircle" cx="60" cy="60" r="50" stroke="url(#progressGradient)" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="314.16" stroke-dashoffset="314.16" class="transition-all duration-1000 ease-out" /> <!-- Gradient Definition --> <defs>
        <lineargradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
         <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
         <stop offset="50%" style="stop-color:#059669;stop-opacity:1" />
         <stop offset="100%" style="stop-color:#047857;stop-opacity:1" />
        </lineargradient>
       </defs>
      </svg><!-- Center Content -->
      <div class="absolute inset-0 flex flex-col items-center justify-center px-4">
       <div class="text-sm sm:text-base text-gray-500 leading-tight text-center mb-3">
        ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß
       </div>
       <div id="totalPaid" class="font-bold text-2xl sm:text-3xl text-gray-800 leading-tight text-center">
        0 ‡∏ö‡∏≤‡∏ó
       </div>
      </div>
     </div>
    </div>
    <div class="space-y-4 sm:space-y-5">
     <div class="flex justify-between items-center"><span class="text-lg sm:text-xl text-gray-600 leading-tight">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</span> <span id="paidInstallments" class="font-bold text-lg sm:text-xl leading-tight">0 ‡∏á‡∏ß‡∏î</span>
     </div>
     <div class="flex justify-between items-center"><span class="text-lg sm:text-xl text-gray-600 leading-tight">‡∏á‡∏ß‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span> <span class="font-bold text-lg sm:text-xl leading-tight">84 ‡∏á‡∏ß‡∏î</span>
     </div><!-- Loan Information Link -->
     <div class="text-center"><button onclick="showLoanDetailsModal()" class="text-gray-400 hover:text-gray-600 font-medium text-base sm:text-lg underline hover:no-underline transition-all duration-200 cursor-pointer"> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ </button>
     </div>
    </div>
   </div><!-- Card 2: Payment -->
   <div class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 mb-4 sm:mb-6 card-shadow">
    <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-5 text-center leading-tight">‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h3>
    <p class="text-2xl sm:text-3xl font-bold text-orange-600 mb-2 sm:mb-3 text-center leading-tight">13,000 ‡∏ö‡∏≤‡∏ó</p>
    <p class="text-base sm:text-lg text-gray-600 mb-4 sm:mb-5 text-center leading-tight">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà XX ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p><button onclick="showPaymentModal()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3.5 sm:py-4 px-5 sm:px-7 rounded-lg sm:rounded-xl transition-colors text-base sm:text-lg"> <i class="fas fa-credit-card mr-2 sm:mr-2.5 text-base"></i>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô </button>
   </div><!-- Card 3: Payment History -->
   <div class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 card-shadow">
    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4 leading-tight">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
    <div id="paymentHistory" class="space-y-3 sm:space-y-4">
     <p class="text-sm sm:text-base text-gray-500 text-center py-6 sm:py-8 leading-tight">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
    </div>
   </div>
  </div><!-- Admin Panel -->
  <div id="adminPanel" class="container mx-auto px-3 py-6 max-w-sm sm:max-w-6xl sm:px-4 sm:py-8 hidden">
   <div class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-6 card-shadow"><!-- Admin Header with Settings Button -->
    <div class="flex justify-between items-center mb-4 sm:mb-6">
     <h2 class="text-xl sm:text-2xl font-bold text-gray-800">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2><!-- Admin Settings Button -->
     <div class="relative"><button id="adminSettingsBtn" onclick="toggleAdminSettingsMenu()" class="bg-gray-100 hover:bg-gray-200 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200"> <i class="fas fa-cog text-gray-600 text-sm sm:text-base"></i> </button> <!-- Admin Settings Dropdown Menu -->
      <div id="adminSettingsMenu" class="absolute top-12 right-0 bg-white rounded-xl shadow-xl border border-gray-200 py-2 w-48 hidden z-20"><!-- Install App Button --> <button id="adminInstallAppBtn" onclick="installPWA(); hideAdminSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center hidden"> <i class="fas fa-download text-purple-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</span> </button>
       <div id="adminInstallDivider" class="border-t border-gray-100 my-1 hidden"></div><button onclick="showThemeSelector(); hideAdminSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-palette text-blue-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡∏™‡∏µ</span> </button>
       <div class="border-t border-gray-100 my-1"></div><button onclick="showMainPage(); hideAdminSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-home text-green-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span> </button> <button onclick="showAdminPanel(); hideAdminSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-clipboard-check text-purple-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span> </button>
       <div class="border-t border-gray-100 my-1"></div><button onclick="logout(); hideAdminSettingsMenu();" class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center"> <i class="fas fa-sign-out-alt text-red-500 mr-3 text-sm"></i> <span class="text-gray-700 text-sm font-medium">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span> </button>
      </div>
     </div>
    </div><!-- Mobile View -->
    <div id="adminDataMobile" class="block sm:hidden space-y-4"><!-- Mobile cards will be inserted here -->
    </div><!-- Desktop View -->
    <div id="adminData" class="hidden sm:block overflow-x-auto">
     <table class="w-full table-auto">
      <thead>
       <tr class="bg-gray-50">
        <th class="px-4 py-2 text-left">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
        <th class="px-4 py-2 text-left">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
        <th class="px-4 py-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
        <th class="px-4 py-2 text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th class="px-4 py-2 text-left">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
       </tr>
      </thead>
      <tbody id="adminTableBody">
       <tr>
        <td colspan="5" class="text-center py-8 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
  </div><!-- Login Modal -->
  <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4">
    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
    <div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="adminPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
    </div>
    <div class="flex space-x-4"><button onclick="adminLogin()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button> <button onclick="hideLoginModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
   </div>
  </div><!-- Payment Modal -->
  <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-8 max-w-sm sm:max-w-md w-full mx-3 sm:mx-4 max-h-[90vh] overflow-y-auto">
    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 sm:mb-6 text-center leading-tight">‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
    <div class="mb-4 sm:mb-6"><label class="block text-gray-700 text-sm font-bold mb-2 sm:mb-3 leading-tight">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
     <div class="relative"><input type="file" id="paymentImage" accept="image/*,.jpg,.jpeg,.png,.gif,.bmp,.webp,.svg,.tiff,.tif,.ico,.heic,.heif,.avif,.jfif" class="hidden">
      <div onclick="document.getElementById('paymentImage').click()" class="border-2 border-dashed border-gray-300 hover:border-blue-400 rounded-lg p-4 sm:p-6 text-center cursor-pointer transition-all duration-200 hover:bg-gray-50">
       <div class="flex flex-col items-center"><i class="fas fa-upload text-gray-400 text-xl sm:text-2xl mb-2 sm:mb-3"></i>
        <p class="text-gray-600 font-medium mb-1 text-sm sm:text-base leading-tight">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
        <p class="text-gray-400 text-xs sm:text-sm leading-tight">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</p>
       </div>
      </div>
     </div>
     <div id="imagePreview" class="mt-4 hidden">
      <div class="relative"><img id="previewImg" class="w-full h-48 object-cover rounded-lg border border-gray-200"> <button onclick="removeImage()" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white w-7 h-7 rounded-full flex items-center justify-center transition-colors shadow-lg"> <i class="fas fa-times text-xs"></i> </button>
       <div class="absolute bottom-2 left-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-medium"><i class="fas fa-check mr-1"></i>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
       </div>
      </div>
     </div>
    </div>
    <div class="mb-4 sm:mb-6"><label class="block text-gray-700 text-sm font-bold mb-2 leading-tight">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞</label> <input type="number" id="paymentAmount" min="13000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 13,000 ‡∏ö‡∏≤‡∏ó)">
     <p class="text-xs sm:text-sm text-red-500 mt-1 leading-tight">*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 13,000 ‡∏ö‡∏≤‡∏ó</p>
    </div>
    <div class="mb-4 sm:mb-6"><label class="block text-gray-700 text-sm font-bold mb-2 leading-tight">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label> <input type="text" id="paymentDateTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-sm sm:text-base" readonly>
    </div>
    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4"><button id="confirmBtn" onclick="confirmPayment()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 sm:py-2 px-4 rounded-lg transition-colors text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed"> <span id="confirmText">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span> <span id="loadingText" class="hidden flex items-center justify-center"> <i class="fas fa-spinner fa-spin mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å... </span> </button> <button onclick="hidePaymentModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2.5 sm:py-2 px-4 rounded-lg transition-colors text-sm sm:text-base">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
   </div>
  </div><!-- Success Modal -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4">
    <div class="text-center">
     <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-check text-green-600 text-2xl"></i>
     </div>
     <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
     <p class="text-gray-600 mb-6">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ 1-2 ‡∏ß‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</p><button onclick="hideSuccessModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>
   </div>
  </div><!-- Error Modal -->
  <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4">
    <div class="text-center">
     <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-times text-red-600 text-2xl"></i>
     </div>
     <h3 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
     <p id="errorMessage" class="text-gray-600 mb-6">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p><button onclick="hideErrorModal()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>
   </div>
  </div><!-- Icon Selector Modal -->
  <div id="iconSelectorModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</h3><!-- Upload Custom Image -->
    <div class="mb-6"><button onclick="document.getElementById('profileImageInput').click()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition-colors mb-4"> <i class="fas fa-upload mr-2"></i>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì </button>
    </div><!-- Icon Selection -->
    <div class="mb-6">
     <h4 class="text-lg font-bold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô (4 ‡∏™‡πÑ‡∏ï‡∏•‡πå)</h4>
     <div class="grid grid-cols-2 gap-4"><button onclick="selectIcon('home1')" class="bg-blue-100 hover:bg-blue-200 p-6 rounded-xl transition-colors flex flex-col items-center"> <i class="fas fa-home text-3xl text-blue-600 mb-2"></i> <span class="text-sm text-blue-600 font-medium">‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å</span> </button> <button onclick="selectIcon('home2')" class="bg-green-100 hover:bg-green-200 p-6 rounded-xl transition-colors flex flex-col items-center"> <i class="fas fa-house-chimney text-3xl text-green-600 mb-2"></i> <span class="text-sm text-green-600 font-medium">‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏ü</span> </button> <button onclick="selectIcon('home3')" class="bg-purple-100 hover:bg-purple-200 p-6 rounded-xl transition-colors flex flex-col items-center"> <i class="fas fa-building text-3xl text-purple-600 mb-2"></i> <span class="text-sm text-purple-600 font-medium">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏π‡∏á</span> </button> <button onclick="selectIcon('home4')" class="bg-orange-100 hover:bg-orange-200 p-6 rounded-xl transition-colors flex flex-col items-center"> <i class="fas fa-house-user text-3xl text-orange-600 mb-2"></i> <span class="text-sm text-orange-600 font-medium">‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</span> </button>
     </div>
    </div>
    <div class="flex space-x-4"><button onclick="hideIconSelector()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
   </div>
  </div><!-- Theme Selector Modal -->
  <div id="themeSelectorModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°‡∏™‡∏µ</h3>
    <div class="grid grid-cols-2 gap-4 mb-6"><!-- Blue Theme --> <button onclick="changeTheme('blue')" class="theme-preview bg-gradient-to-br from-blue-50 to-indigo-100 p-6 rounded-xl border-2 border-transparent hover:border-blue-400 transition-all duration-200 flex flex-col items-center">
      <div class="w-12 h-12 bg-white rounded-full mb-3 flex items-center justify-center border border-gray-300"><i class="fas fa-circle text-gray-400"></i>
      </div><span class="text-sm font-medium text-blue-700">‡∏ò‡∏µ‡∏°‡∏Ç‡∏≤‡∏ß</span> </button> <!-- Green Theme --> <button onclick="changeTheme('green')" class="theme-preview bg-gradient-to-br from-gray-600 to-gray-700 p-6 rounded-xl border-2 border-transparent hover:border-gray-400 transition-all duration-200 flex flex-col items-center">
      <div class="w-12 h-12 bg-gray-700 rounded-full mb-3 flex items-center justify-center"><i class="fas fa-square text-white"></i>
      </div><span class="text-sm font-medium text-white">‡∏ò‡∏µ‡∏°‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°</span> </button> <!-- Purple Theme --> <button onclick="changeTheme('purple')" class="theme-preview bg-gradient-to-br from-purple-50 to-violet-100 p-6 rounded-xl border-2 border-transparent hover:border-purple-400 transition-all duration-200 flex flex-col items-center">
      <div class="w-12 h-12 bg-purple-500 rounded-full mb-3 flex items-center justify-center"><i class="fas fa-gem text-white"></i>
      </div><span class="text-sm font-medium text-purple-700">‡∏ò‡∏µ‡∏°‡∏°‡πà‡∏ß‡∏á</span> </button> <!-- Yellow Theme --> <button onclick="changeTheme('yellow')" class="theme-preview bg-gradient-to-br from-yellow-50 to-amber-100 p-6 rounded-xl border-2 border-transparent hover:border-yellow-400 transition-all duration-200 flex flex-col items-center">
      <div class="w-12 h-12 bg-yellow-500 rounded-full mb-3 flex items-center justify-center"><i class="fas fa-sun text-white"></i>
      </div><span class="text-sm font-medium text-yellow-700">‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</span> </button> <!-- Red Theme --> <button onclick="changeTheme('red')" class="theme-preview bg-gradient-to-br from-red-50 to-rose-100 p-6 rounded-xl border-2 border-transparent hover:border-red-400 transition-all duration-200 flex flex-col items-center">
      <div class="w-12 h-12 bg-red-500 rounded-full mb-3 flex items-center justify-center"><i class="fas fa-fire text-white"></i>
      </div><span class="text-sm font-medium text-red-700">‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á</span> </button> <!-- Dark Blue Theme --> <button onclick="changeTheme('darkblue')" class="theme-preview bg-gradient-to-br from-slate-100 to-blue-200 p-6 rounded-xl border-2 border-transparent hover:border-slate-400 transition-all duration-200 flex flex-col items-center">
      <div class="w-12 h-12 bg-blue-600 rounded-full mb-3 flex items-center justify-center"><i class="fas fa-droplet text-white"></i>
      </div><span class="text-sm font-medium text-slate-700">‡∏ò‡∏µ‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô</span> </button>
    </div>
    <div class="flex space-x-4"><button onclick="hideThemeSelector()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">‡∏õ‡∏¥‡∏î</button>
    </div>
   </div>
  </div><!-- Loan Details Modal -->
  <div id="loanDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-xl sm:rounded-2xl p-4 sm:p-8 max-w-sm sm:max-w-md w-full mx-3 sm:mx-4 max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-4 sm:mb-6">
     <h3 class="text-lg sm:text-xl font-bold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3><button onclick="hideLoanDetailsModal()" class="bg-gray-500 hover:bg-gray-600 text-white w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center transition-colors"> <i class="fas fa-times text-sm"></i> </button>
    </div>
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 sm:p-5 border border-blue-200">
     <div class="space-y-3 sm:space-y-4 text-sm sm:text-base">
      <div class="flex justify-between items-center py-2 border-b border-blue-100"><span class="text-gray-700 font-medium">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏ö‡πâ‡∏≤‡∏ô</span> <span class="font-bold text-blue-700">1,012,000 ‡∏ö‡∏≤‡∏ó</span>
      </div>
      <div class="flex justify-between items-center py-2 border-b border-blue-100"><span class="text-gray-700 font-medium">‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span> <span class="font-bold text-blue-700">13,000 ‡∏ö‡∏≤‡∏ó</span>
      </div>
      <div class="flex justify-between items-center py-2 border-b border-blue-100"><span class="text-gray-700 font-medium">‡∏á‡∏ß‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà 84</span> <span class="font-bold text-orange-600">12,000 ‡∏ö‡∏≤‡∏ó</span>
      </div>
      <div class="flex justify-between items-center py-2 border-b border-blue-100"><span class="text-gray-700 font-medium">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô</span> <span class="font-bold text-blue-700">84 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏á‡∏ß‡∏î</span>
      </div>
      <div class="flex justify-between items-center py-2 border-b border-blue-100"><span class="text-gray-700 font-medium">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</span> <span class="font-bold text-blue-700">2% ‡∏•‡∏î‡∏ï‡πâ‡∏ô‡∏•‡∏î‡∏î‡∏≠‡∏Å</span>
      </div>
      <div class="flex justify-between items-center py-2 border-b border-blue-100"><span class="text-gray-700 font-medium">‡∏¢‡∏≠‡∏î‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span> <span class="font-bold text-orange-600">71,063 ‡∏ö‡∏≤‡∏ó</span>
      </div>
      <div class="flex justify-between items-center py-2 bg-red-50 rounded-lg px-3 border border-red-200"><span class="text-gray-700 font-bold">‡∏ï‡∏Å‡∏•‡∏á‡∏à‡∏∞‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span> <span class="font-bold text-red-600 text-lg">80,000 ‡∏ö‡∏≤‡∏ó</span>
      </div>
     </div>
    </div>
    <div class="mt-4 sm:mt-6 space-y-3"><button onclick="openPaymentSchedule()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base"> <i class="fas fa-table mr-2"></i>‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡πà‡∏≠‡∏ô </button> <button onclick="hideLoanDetailsModal()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base"> ‡∏õ‡∏¥‡∏î </button>
    </div>
   </div>
  </div><!-- Image Modal -->
  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 modal-backdrop hidden flex items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-6 max-w-4xl max-h-[90vh] w-full mx-4 overflow-auto">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold text-gray-800">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3><button onclick="hideImageModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors"> <i class="fas fa-times mr-2"></i>‡∏õ‡∏¥‡∏î </button>
    </div>
    <div class="text-center"><img id="modalImage" src="" alt="‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô" class="max-w-full max-h-[70vh] object-contain rounded-lg border">
    </div>
   </div>
  </div>
  <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwBf4HUcPviUItRRrCOPtEKhOZyUB64lGWnYr5pV83imWLvshYDp-XAyayC8fpURex3mw/exec';
        let isAdmin = false;
        let allData = [];
        let originalData = []; // Store original data order from server
        let currentPage = 1;
        const itemsPerPage = 12;

        // PWA Installation
        let deferredPrompt;
        let installButton;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is logged in from localStorage
            const adminLoggedIn = localStorage.getItem('adminLoggedIn');
            if (adminLoggedIn === 'true') {
                isAdmin = true;
                updateSettingsMenu();
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
            }
            
            // Initialize PWA install functionality
            initializePWAInstall();
            
            // Close settings menu when clicking outside
            document.addEventListener('click', function(event) {
                const settingsBtn = document.getElementById('settingsBtn');
                const settingsMenu = document.getElementById('settingsMenu');
                const adminSettingsBtn = document.getElementById('adminSettingsBtn');
                const adminSettingsMenu = document.getElementById('adminSettingsMenu');
                
                if (!settingsBtn.contains(event.target) && !settingsMenu.contains(event.target)) {
                    hideSettingsMenu();
                }
                
                if (adminSettingsBtn && adminSettingsMenu && 
                    !adminSettingsBtn.contains(event.target) && !adminSettingsMenu.contains(event.target)) {
                    hideAdminSettingsMenu();
                }
            });
            
            // Load saved theme
            const savedTheme = localStorage.getItem('selectedTheme') || 'blue';
            applyTheme(savedTheme);
            
            // Load saved profile image
            const savedProfileImage = localStorage.getItem('profileImage');
            if (savedProfileImage) {
                document.getElementById('profileImageTop').src = savedProfileImage;
            }
            
            // Initialize button fade system
            initializeButtonFade();
            
            loadData();
            
            // Image preview
            document.getElementById('paymentImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('previewImg').src = e.target.result;
                        document.getElementById('imagePreview').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Profile image change
            document.getElementById('profileImageInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        document.getElementById('profileImageTop').src = imageData;
                        localStorage.setItem('profileImage', imageData);
                        localStorage.removeItem('selectedIconType'); // Clear icon selection when custom image is uploaded
                        hideIconSelector(); // Close the modal after upload
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        // Load data from Google Sheets
        async function loadData() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getData`);
                const data = await response.json();
                
                // Store original data order (as received from server)
                originalData = [...data];
                
                // Sort data by newest first for display - data that was just added will appear at the top
                allData = data.reverse(); // Reverse to show newest entries first
                updateUI(allData);
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Update UI with data
        function updateUI(data) {
            let totalPaid = 0;
            let paidInstallments = 0;
            
            data.forEach(row => {
                if (row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß') {
                    totalPaid += parseFloat(row.amount) || 0;
                    paidInstallments += 1;
                }
            });

            document.getElementById('totalPaid').textContent = totalPaid.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('paidInstallments').textContent = paidInstallments + ' ‡∏á‡∏ß‡∏î';
            
            const progressPercent = (paidInstallments / 84) * 100;
            
            // Update circular progress ring
            const progressCircle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 50; // radius = 50, circumference = 314.16
            const offset = circumference - (progressPercent / 100) * circumference;
            progressCircle.style.strokeDashoffset = offset;

            updatePaymentHistory(data);
            if (isAdmin) {
                updateAdminTable(data);
            }
        }

        // Update payment history
        function updatePaymentHistory(data) {
            const historyDiv = document.getElementById('paymentHistory');
            
            if (data.length === 0) {
                historyDiv.innerHTML = '<p class="text-gray-500 text-center py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>';
                return;
            }

            const totalPages = Math.ceil(data.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentData = data.slice(startIndex, endIndex);

            const historyHTML = currentData.map((row, index) => {
                // Split datetime into date and time parts
                const datetimeParts = row.datetime.split(' ‡πÄ‡∏ß‡∏•‡∏≤ ');
                const datePart = datetimeParts[0] || row.datetime;
                const timePart = datetimeParts[1] || '';
                
                return `
                <div class="border border-gray-200 rounded-lg sm:rounded-xl p-3 sm:p-5 hover:shadow-lg transition-all duration-300 bg-gradient-to-r from-white to-gray-50">
                    <div class="space-y-3">
                        <!-- ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1: ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏™‡∏•‡∏µ‡∏õ ‡πÅ‡∏•‡∏∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô -->
                        <div class="flex justify-between items-center">
                            <button onclick="openImageInNewTab('${row.imageUrl}')" class="group bg-blue-500 hover:bg-blue-600 text-white px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-md sm:rounded-lg text-xs font-medium transition-all duration-200 flex-shrink-0 shadow-sm hover:shadow-md flex items-center">
                                <i class="fas fa-receipt mr-1 sm:mr-1.5 text-xs"></i>
                                <span class="text-xs">‡∏™‡∏•‡∏µ‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                                <i class="fas fa-external-link-alt ml-1 sm:ml-1.5 text-xs opacity-70 group-hover:opacity-100 transition-opacity"></i>
                            </button>
                            <p class="font-bold text-lg sm:text-xl text-gray-800 leading-tight">${parseFloat(row.amount).toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        
                        <!-- ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
                        <div class="flex justify-between items-center">
                            <div class="flex flex-col">
                                <p class="text-gray-500 text-xs sm:text-sm flex items-center mb-1 leading-tight">
                                    <i class="fas fa-calendar-alt mr-1.5 sm:mr-2 text-gray-400 text-xs"></i>
                                    ${datePart}
                                </p>
                                ${timePart ? `<p class="text-gray-400 text-xs flex items-center ml-4 sm:ml-6 leading-tight">
                                    <i class="fas fa-clock mr-1.5 sm:mr-2 text-gray-300 text-xs"></i>
                                    ${timePart}
                                </p>` : ''}
                            </div>
                            <span class="inline-flex items-center px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-full text-xs sm:text-sm font-medium ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-800 border border-green-200' : 'bg-red-100 text-red-800 border border-red-200'}">
                                <i class="fas ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'fa-check-circle' : 'fa-clock'} mr-1 sm:mr-1.5 text-xs"></i>
                                ${row.status}
                            </span>
                        </div>
                    </div>
                </div>
                `;
            }).join('');

            // Pagination controls
            let paginationHTML = '';
            if (totalPages > 1) {
                paginationHTML = `
                    <div class="flex justify-center items-center space-x-2 sm:space-x-3 mt-6 sm:mt-8">
                        <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} 
                                class="px-3 py-2 sm:px-4 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium ${currentPage === 1 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-0.5'} transition-all duration-300 flex items-center">
                            <i class="fas fa-chevron-left mr-1 text-xs"></i>
                            <span class="hidden sm:inline">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</span>
                        </button>
                        <div class="bg-white rounded-lg sm:rounded-xl px-3 py-2 sm:px-6 sm:py-3 shadow-md border border-gray-200">
                            <span class="text-xs sm:text-sm font-medium text-gray-700 leading-tight">‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} ‡∏à‡∏≤‡∏Å ${totalPages}</span>
                        </div>
                        <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} 
                                class="px-3 py-2 sm:px-4 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium ${currentPage === totalPages ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-0.5'} transition-all duration-300 flex items-center">
                            <span class="hidden sm:inline">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
                            <i class="fas fa-chevron-right ml-1 text-xs"></i>
                        </button>
                    </div>
                `;
            }

            historyDiv.innerHTML = historyHTML + paginationHTML;
        }

        // Show payment modal
        function showPaymentModal() {
            const now = new Date();
            const thaiDate = now.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            const thaiTime = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('paymentDateTime').value = `${thaiDate} ‡πÄ‡∏ß‡∏•‡∏≤ ${thaiTime}`;
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        // Hide payment modal
        function hidePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
            document.getElementById('paymentImage').value = '';
            document.getElementById('paymentAmount').value = '';
            document.getElementById('imagePreview').classList.add('hidden');
        }

        // Confirm payment
        async function confirmPayment() {
            const imageFile = document.getElementById('paymentImage').files[0];
            const amount = document.getElementById('paymentAmount').value;
            const datetime = document.getElementById('paymentDateTime').value;

            if (!imageFile || !amount) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            if (parseFloat(amount) < 13000) {
                showError('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 13,000 ‡∏ö‡∏≤‡∏ó');
                return;
            }

            // Show loading state
            const confirmBtn = document.getElementById('confirmBtn');
            const confirmText = document.getElementById('confirmText');
            const loadingText = document.getElementById('loadingText');
            
            confirmBtn.disabled = true;
            confirmText.classList.add('hidden');
            loadingText.classList.remove('hidden');

            try {
                // Convert image to base64
                const base64 = await fileToBase64(imageFile);
                
                const formData = new URLSearchParams();
                formData.append('action', 'addPayment');
                formData.append('amount', amount);
                formData.append('datetime', datetime);
                formData.append('status', '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                formData.append('imageData', base64);
                formData.append('fileName', imageFile.name);
                formData.append('mimeType', imageFile.type);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    hidePaymentModal();
                    showSuccess();
                    loadData();
                } else {
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            } finally {
                // Reset loading state
                confirmBtn.disabled = false;
                confirmText.classList.remove('hidden');
                loadingText.classList.add('hidden');
            }
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        // Login functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === '000') {
                isAdmin = true;
                localStorage.setItem('adminLoggedIn', 'true'); // Save admin status
                hideLoginModal();
                updateSettingsMenu();
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadData();
            } else {
                showError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        function logout() {
            isAdmin = false;
            localStorage.removeItem('adminLoggedIn'); // Remove admin status
            updateSettingsMenu();
            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        // Admin functions
        function updateAdminTable(data) {
            const tbody = document.getElementById('adminTableBody');
            const mobileContainer = document.getElementById('adminDataMobile');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                mobileContainer.innerHTML = '<div class="text-center py-8 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
                return;
            }

            // Desktop table view
            tbody.innerHTML = data.map((row, index) => `
                <tr class="border-b">
                    <td class="px-4 py-2">
                        <button onclick="openImageInNewTab('${row.imageUrl}')" class="group bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 shadow-sm hover:shadow-md flex items-center">
                            <i class="fas fa-receipt mr-1.5 text-xs"></i>
                            <span>‡∏™‡∏•‡∏µ‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                            <i class="fas fa-external-link-alt ml-1.5 text-xs opacity-70 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                    </td>
                    <td class="px-4 py-2">${parseFloat(row.amount).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                    <td class="px-4 py-2">${row.datetime}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded text-sm ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${row.status}
                        </span>
                    </td>
                    <td class="px-4 py-2">
                        <div class="flex flex-wrap gap-2">
                            <div class="relative">
                                <select onchange="updateStatusQuick(${index}, this.value, this)" class="appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 cursor-pointer ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'text-green-700 bg-green-50 border-green-300' : 'text-red-700 bg-red-50 border-red-300'}">
                                    <option value="‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${row.status === '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                                    <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß" ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                    <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                                </div>
                            </div>
                            <button onclick="editAmount(${index})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg text-sm transition-colors duration-200 flex items-center">
                                <i class="fas fa-edit mr-1"></i>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Mobile card view
            mobileContainer.innerHTML = data.map((row, index) => {
                // Split datetime into date and time parts
                const datetimeParts = row.datetime.split(' ‡πÄ‡∏ß‡∏•‡∏≤ ');
                const datePart = datetimeParts[0] || row.datetime;
                const timePart = datetimeParts[1] || '';
                
                return `
                <div class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm">
                    <!-- Header with amount and status -->
                    <div class="flex justify-between items-start mb-3">
                        <div class="font-bold text-lg text-gray-800">${parseFloat(row.amount).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-800 border border-green-200' : 'bg-red-100 text-red-800 border border-red-200'}">
                            <i class="fas ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'fa-check-circle' : 'fa-clock'} mr-1 text-xs"></i>
                            ${row.status}
                        </span>
                    </div>
                    
                    <!-- Date and time -->
                    <div class="mb-3">
                        <div class="text-gray-600 text-sm flex items-center mb-1">
                            <i class="fas fa-calendar-alt mr-2 text-gray-400 text-xs"></i>
                            ${datePart}
                        </div>
                        ${timePart ? `<div class="text-gray-500 text-xs flex items-center ml-5">
                            <i class="fas fa-clock mr-2 text-gray-300 text-xs"></i>
                            ${timePart}
                        </div>` : ''}
                    </div>
                    
                    <!-- Receipt button -->
                    <div class="mb-4">
                        <button onclick="openImageInNewTab('${row.imageUrl}')" class="w-full group bg-gray-600 hover:bg-gray-700 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-all duration-200 shadow-sm hover:shadow-md flex items-center justify-center">
                            <i class="fas fa-receipt mr-2 text-xs"></i>
                            <span>‡∏™‡∏•‡∏µ‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                            <i class="fas fa-external-link-alt ml-2 text-xs opacity-70 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                    </div>
                    
                    <!-- Action buttons -->
                    <div class="space-y-2">
                        <!-- Status selector -->
                        <div class="relative">
                            <select onchange="updateStatusQuick(${index}, this.value, this)" class="w-full appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2.5 pr-10 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 cursor-pointer ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'text-green-700 bg-green-50 border-green-300' : 'text-red-700 bg-red-50 border-red-300'}">
                                <option value="‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${row.status === '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                                <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß" ${row.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                            </div>
                        </div>
                        
                        <!-- Edit button -->
                        <div>
                            <button onclick="editAmount(${index})" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2.5 px-4 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center justify-center">
                                <i class="fas fa-edit mr-2 text-xs"></i>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        async function updateStatus(index, newStatus) {
            try {
                const formData = new URLSearchParams();
                formData.append('action', 'updateStatus');
                formData.append('rowIndex', index + 2); // +2 because sheet starts from row 2
                formData.append('status', newStatus);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    loadData();
                }
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }

        async function updateStatusQuick(index, newStatus, selectElement) {
            // Show loading state
            if (!selectElement) {
                selectElement = event.target;
            }
            const originalValue = allData[index].status;
            selectElement.disabled = true;
            selectElement.style.opacity = '0.6';
            
            try {
                // Find the correct row index in the original data
                const currentItem = allData[index];
                let actualRowIndex = -1;
                
                // Find the matching item in original data to get the correct row index
                for (let i = 0; i < originalData.length; i++) {
                    if (originalData[i].datetime === currentItem.datetime && 
                        originalData[i].amount === currentItem.amount &&
                        originalData[i].imageUrl === currentItem.imageUrl) {
                        actualRowIndex = i + 2; // +2 because sheet starts from row 2
                        break;
                    }
                }
                
                if (actualRowIndex === -1) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
                }
                
                const formData = new URLSearchParams();
                formData.append('action', 'updateStatus');
                formData.append('rowIndex', actualRowIndex);
                formData.append('status', newStatus);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    // Update local data and UI
                    allData[index].status = newStatus;
                    updateAdminTable(allData);
                    updateUI(allData);
                    
                    // Show success feedback
                    if (newStatus === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß') {
                        showSuccessMessage('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    } else {
                        showSuccessMessage('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß');
                    }
                } else {
                    // Revert selection if failed
                    selectElement.value = originalValue;
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ' + (result.error || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'));
                }
            } catch (error) {
                console.error('Error updating status:', error);
                // Revert selection if failed
                selectElement.value = originalValue;
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error.message);
            } finally {
                // Reset loading state
                selectElement.disabled = false;
                selectElement.style.opacity = '1';
            }
        }

        async function editAmount(index) {
            const row = allData[index];
            const newAmount = prompt('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:', row.amount);
            
            if (newAmount && !isNaN(newAmount)) {
                try {
                    // Find the correct row index in the original data
                    const currentItem = allData[index];
                    let actualRowIndex = -1;
                    
                    // Find the matching item in original data to get the correct row index
                    for (let i = 0; i < originalData.length; i++) {
                        if (originalData[i].datetime === currentItem.datetime && 
                            originalData[i].amount === currentItem.amount &&
                            originalData[i].imageUrl === currentItem.imageUrl) {
                            actualRowIndex = i + 2; // +2 because sheet starts from row 2
                            break;
                        }
                    }
                    
                    if (actualRowIndex === -1) {
                        throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
                    }

                    const formData = new URLSearchParams();
                    formData.append('action', 'updateAmount');
                    formData.append('rowIndex', actualRowIndex);
                    formData.append('amount', newAmount);

                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();
                    if (result.success) {
                        loadData();
                        showSuccessMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    } else {
                        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');
                    }
                } catch (error) {
                    console.error('Error updating amount:', error);
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ' + error.message);
                }
            }
        }

        async function deleteRecord(index) {
            const row = allData[index];
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ${parseFloat(row.amount).toLocaleString()} ‡∏ö‡∏≤‡∏ó\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${row.datetime}\n‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${row.status}`)) {
                try {
                    // Find the correct row index in the original data
                    const currentItem = allData[index];
                    let actualRowIndex = -1;
                    
                    // Find the matching item in original data to get the correct row index
                    for (let i = 0; i < originalData.length; i++) {
                        if (originalData[i].datetime === currentItem.datetime && 
                            originalData[i].amount === currentItem.amount &&
                            originalData[i].imageUrl === currentItem.imageUrl) {
                            actualRowIndex = i + 2; // +2 because sheet starts from row 2
                            break;
                        }
                    }
                    
                    if (actualRowIndex === -1) {
                        throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö');
                    }
                    
                    // Remove from local array immediately for better UX
                    const deletedItem = allData.splice(index, 1)[0];
                    updateAdminTable(allData);
                    updateUI(allData);
                    
                    const formData = new URLSearchParams();
                    formData.append('action', 'deleteRecord');
                    formData.append('rowIndex', actualRowIndex);

                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();
                    if (result.success) {
                        // Successfully deleted from server, reload to ensure consistency
                        loadData();
                        showSuccessMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    } else {
                        // If deletion failed, restore the item
                        allData.splice(index, 0, deletedItem);
                        updateAdminTable(allData);
                        updateUI(allData);
                        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                    }
                } catch (error) {
                    console.error('Error deleting record:', error);
                    // Reload data to ensure consistency
                    loadData();
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
                }
            }
        }

        // Modal functions
        function showSuccess() {
            document.getElementById('successModal').classList.remove('hidden');
        }

        function hideSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.remove('hidden');
        }

        function hideErrorModal() {
            document.getElementById('errorModal').classList.add('hidden');
        }

        function showSuccessMessage(message) {
            // Create a temporary success notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Image modal functions
        function showImageModal(imageUrl) {
            if (imageUrl && imageUrl !== '/api/placeholder/60/60') {
                document.getElementById('modalImage').src = imageUrl;
                document.getElementById('imageModal').classList.remove('hidden');
            } else {
                showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô');
            }
        }

        function hideImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }

        // Open image in new tab
        function openImageInNewTab(imageUrl) {
            if (imageUrl && imageUrl !== '/api/placeholder/60/60') {
                window.open(imageUrl, '_blank');
            } else {
                showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô');
            }
        }

        // Pagination functions
        function changePage(page) {
            const totalPages = Math.ceil(allData.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updatePaymentHistory(allData);
            }
        }

        // Show main page function
        function showMainPage() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        // Show admin panel function
        function showAdminPanel() {
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        // Back to admin function (kept for compatibility)
        function backToAdmin() {
            // Switch back to admin panel from main page
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        // Icon selector functions
        function showIconSelector() {
            document.getElementById('iconSelectorModal').classList.remove('hidden');
        }

        function hideIconSelector() {
            document.getElementById('iconSelectorModal').classList.add('hidden');
        }

        function selectIcon(iconType) {
            const iconMap = {
                'home1': { icon: 'fas fa-home', color: '#3b82f6', emoji: 'üè†', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å' },
                'home2': { icon: 'fas fa-house-chimney', color: '#059669', emoji: 'üèòÔ∏è', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏ü' },
                'home3': { icon: 'fas fa-building', color: '#7c3aed', emoji: 'üè¢', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏π‡∏á' },
                'home4': { icon: 'fas fa-house-user', color: '#ea580c', emoji: 'üè°', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß' }
            };

            const selectedIcon = iconMap[iconType];
            if (selectedIcon) {
                // Create a beautiful SVG icon with gradient background
                const profileImage = document.getElementById('profileImageTop');
                profileImage.src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='grad' cx='50%25' cy='30%25' r='70%25'%3E%3Cstop offset='0%25' style='stop-color:${encodeURIComponent(selectedIcon.color)};stop-opacity:0.3' /%3E%3Cstop offset='100%25' style='stop-color:${encodeURIComponent(selectedIcon.color)};stop-opacity:0.1' /%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad)' stroke='${encodeURIComponent(selectedIcon.color)}' stroke-width='2' opacity='0.8'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-size='35' fill='${encodeURIComponent(selectedIcon.color)}'%3E${selectedIcon.emoji}%3C/text%3E%3C/svg%3E`;
                
                // Store the icon selection
                localStorage.setItem('profileImage', profileImage.src);
                localStorage.setItem('selectedIconType', iconType);
                
                hideIconSelector();
            }
        }

        function getIconUnicode(iconClass) {
            // Map Font Awesome classes to Unicode (simplified)
            const iconUnicodeMap = {
                'fas fa-home': 'üè†',
                'fas fa-house': 'üè°',
                'fas fa-house-user': 'üèòÔ∏è',
                'fas fa-house-chimney': 'üè†',
                'fas fa-building': 'üè¢',
                'fas fa-city': 'üèôÔ∏è',
                'fas fa-house-flag': 'üè¥',
                'fas fa-warehouse': 'üè≠'
            };
            return iconUnicodeMap[iconClass] || 'üè†';
        }

        // Change profile image function
        function changeProfileImage() {
            document.getElementById('profileImageInput').click();
        }

        // Remove uploaded image function
        function removeImage() {
            document.getElementById('paymentImage').value = '';
            document.getElementById('imagePreview').classList.add('hidden');
        }

        // Theme functions
        function showThemeSelector() {
            document.getElementById('themeSelectorModal').classList.remove('hidden');
        }

        function hideThemeSelector() {
            document.getElementById('themeSelectorModal').classList.add('hidden');
        }

        function changeTheme(themeName) {
            applyTheme(themeName);
            localStorage.setItem('selectedTheme', themeName);
            hideThemeSelector();
        }

        function applyTheme(themeName) {
            const body = document.body;
            
            // Remove all theme classes
            body.classList.remove('theme-blue', 'theme-green', 'theme-purple', 'theme-yellow', 'theme-red', 'theme-cyan', 'theme-darkblue');
            
            // Apply new theme
            body.classList.add(`theme-${themeName}`);
            
            // Update body background
            body.classList.remove('bg-gradient-to-br', 'from-blue-50', 'to-indigo-100');
            body.classList.add('bg-gradient-to-br');
            
            switch(themeName) {
                case 'green':
                    body.style.background = 'linear-gradient(135deg, #586d72 0%, #4a5d62 100%)';
                    break;
                case 'purple':
                    body.style.background = 'linear-gradient(135deg, #8e8ec2 0%, #7c7cb8 100%)';
                    break;
                case 'yellow':
                    body.style.background = 'linear-gradient(135deg, #ffdb00 0%, #fbbf24 100%)';
                    break;
                case 'red':
                    body.style.background = 'linear-gradient(135deg, #dd2b2b 0%, #b91c1c 100%)';
                    break;
                case 'cyan':
                    body.classList.add('from-cyan-50', 'to-teal-100');
                    break;
                case 'darkblue':
                    body.style.background = 'linear-gradient(135deg, #0050f0 0%, #003bb8 100%)';
                    break;
                default: // blue
                    body.classList.add('from-blue-50', 'to-indigo-100');
                    break;
            }
        }

        // Settings menu functions
        function toggleSettingsMenu() {
            const settingsMenu = document.getElementById('settingsMenu');
            settingsMenu.classList.toggle('hidden');
        }

        function hideSettingsMenu() {
            const settingsMenu = document.getElementById('settingsMenu');
            settingsMenu.classList.add('hidden');
        }

        // Admin settings menu functions
        function toggleAdminSettingsMenu() {
            const adminSettingsMenu = document.getElementById('adminSettingsMenu');
            adminSettingsMenu.classList.toggle('hidden');
        }

        function hideAdminSettingsMenu() {
            const adminSettingsMenu = document.getElementById('adminSettingsMenu');
            adminSettingsMenu.classList.add('hidden');
        }

        function updateSettingsMenu() {
            const loginMenuBtn = document.getElementById('loginMenuBtn');
            const adminMenuItems = document.getElementById('adminMenuItems');
            
            if (isAdmin) {
                loginMenuBtn.classList.add('hidden');
                adminMenuItems.classList.remove('hidden');
            } else {
                loginMenuBtn.classList.remove('hidden');
                adminMenuItems.classList.add('hidden');
            }
        }

        // Button fade system (simplified since buttons are now in menu)
        function initializeButtonFade() {
            // This function is now simplified since buttons are in the settings menu
            // The fade system is no longer needed for the top buttons
        }

        // Loan details modal functions
        function showLoanDetailsModal() {
            document.getElementById('loanDetailsModal').classList.remove('hidden');
        }

        function hideLoanDetailsModal() {
            document.getElementById('loanDetailsModal').classList.add('hidden');
        }

        // Open payment schedule function
        function openPaymentSchedule() {
            window.open('https://drive.google.com/file/d/1W7BW5h4dnvrY0qZFUONvNwcE_e-bo_Ym/view?usp=sharing', '_blank');
        }

        // PWA Installation Functions
        function initializePWAInstall() {
            // Register Service Worker first
            registerServiceWorker();
            
            // Always show install button initially
            showInstallButton();
            
            // Listen for the beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                // Prevent the mini-infobar from appearing on mobile
                e.preventDefault();
                // Stash the event so it can be triggered later
                deferredPrompt = e;
                // Show the install button
                showInstallButton();
                console.log('beforeinstallprompt event fired');
            });

            // Listen for the app installed event
            window.addEventListener('appinstalled', (evt) => {
                console.log('PWA was installed');
                hideInstallButton();
                showInstallSuccessMessage();
            });

            // Check if app is already installed (standalone mode)
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
                console.log('App is running in standalone mode');
                hideInstallButton();
            } else {
                // Force show install button for testing
                setTimeout(() => {
                    showInstallButton();
                }, 1000);
            }

            // For iOS Safari - always show install instructions
            if (isIOSSafari()) {
                showInstallButton(); // Always show for iOS
            }
            
            // Debug: Check PWA requirements
            setTimeout(() => {
                checkPWARequirements();
            }, 2000);
        }

        // Register Service Worker
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    // Create a simple service worker inline
                    const swCode = `
                        const CACHE_NAME = 'house-loan-app-v1';
                        const urlsToCache = [
                            './',
                            'https://cdn.tailwindcss.com',
                            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css',
                            'https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap'
                        ];

                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(urlsToCache))
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => {
                                        if (response) {
                                            return response;
                                        }
                                        return fetch(event.request);
                                    })
                            );
                        });
                    `;
                    
                    const swBlob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(swBlob);
                    
                    const registration = await navigator.serviceWorker.register(swUrl);
                    console.log('Service Worker registered successfully:', registration);
                } catch (error) {
                    console.log('Service Worker registration failed:', error);
                }
            }
        }

        function showInstallButton() {
            const installBtn = document.getElementById('installAppBtn');
            const adminInstallBtn = document.getElementById('adminInstallAppBtn');
            const installDivider = document.getElementById('installDivider');
            const adminInstallDivider = document.getElementById('adminInstallDivider');
            
            if (installBtn) {
                installBtn.classList.remove('hidden');
                installDivider.classList.remove('hidden');
            }
            if (adminInstallBtn) {
                adminInstallBtn.classList.remove('hidden');
                adminInstallDivider.classList.remove('hidden');
            }
        }

        function hideInstallButton() {
            const installBtn = document.getElementById('installAppBtn');
            const adminInstallBtn = document.getElementById('adminInstallAppBtn');
            const installDivider = document.getElementById('installDivider');
            const adminInstallDivider = document.getElementById('adminInstallDivider');
            
            if (installBtn) {
                installBtn.classList.add('hidden');
                installDivider.classList.add('hidden');
            }
            if (adminInstallBtn) {
                adminInstallBtn.classList.add('hidden');
                adminInstallDivider.classList.add('hidden');
            }
        }

        async function installPWA() {
            if (!deferredPrompt) {
                // If no install prompt available, show instructions
                if (isIOSSafari()) {
                    showIOSInstallModal();
                } else {
                    showInstallInstructions();
                }
                return;
            }

            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('User accepted the install prompt');
                showInstallSuccessMessage();
            } else {
                console.log('User dismissed the install prompt');
            }
            
            // Clear the deferredPrompt variable
            deferredPrompt = null;
            hideInstallButton();
        }

        function isIOSSafari() {
            const userAgent = window.navigator.userAgent.toLowerCase();
            const isIOS = /iphone|ipad|ipod/.test(userAgent);
            const isSafari = /safari/.test(userAgent) && !/chrome|crios|fxios/.test(userAgent);
            return isIOS && isSafari;
        }

        function showIOSInstallInstructions() {
            // For iOS, we can't programmatically trigger install, so we show instructions
            if (!window.navigator.standalone) {
                setTimeout(() => {
                    showIOSInstallModal();
                }, 2000); // Show after 2 seconds
            }
        }

        function showIOSInstallModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4">
                    <div class="text-center">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-mobile-alt text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</h3>
                        <div class="text-left space-y-3 mb-6">
                            <div class="flex items-center">
                                <div class="bg-blue-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-3">1</div>
                                <span class="text-sm">‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏° <i class="fas fa-share text-blue-500"></i> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</span>
                            </div>
                            <div class="flex items-center">
                                <div class="bg-blue-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-3">2</div>
                                <span class="text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å"</span>
                            </div>
                            <div class="flex items-center">
                                <div class="bg-blue-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-3">3</div>
                                <span class="text-sm">‡πÅ‡∏ï‡∏∞ "‡πÄ‡∏û‡∏¥‡πà‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</span>
                            </div>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showInstallInstructions() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4">
                    <div class="text-center">
                        <div class="bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-info-circle text-orange-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</h3>
                        <p class="text-gray-600 mb-6 text-sm">
                            ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß
                            <br><br>
                            ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏î‡πâ
                        </p>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showInstallSuccessMessage() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span>‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        function checkPWARequirements() {
            console.log('=== PWA Requirements Check ===');
            console.log('HTTPS:', location.protocol === 'https:' || location.hostname === 'localhost');
            console.log('Service Worker supported:', 'serviceWorker' in navigator);
            console.log('Manifest link:', document.querySelector('link[rel="manifest"]') ? 'Found' : 'Missing');
            console.log('Display mode:', window.matchMedia('(display-mode: standalone)').matches ? 'Standalone' : 'Browser');
            console.log('iOS Safari:', isIOSSafari());
            console.log('User Agent:', navigator.userAgent);
            console.log('Deferred prompt available:', !!deferredPrompt);
            
            // Check Service Worker registration
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    console.log('Service Worker registrations:', registrations.length);
                });
            }
            
            // Check manifest
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) {
                console.log('Manifest href:', manifestLink.href);
                
                // Try to decode the base64 manifest
                try {
                    const base64Data = manifestLink.href.split(',')[1];
                    const manifestJson = atob(base64Data);
                    const manifest = JSON.parse(manifestJson);
                    console.log('Manifest decoded successfully:', manifest);
                    
                    // Check required PWA fields
                    const requiredFields = ['name', 'short_name', 'start_url', 'display', 'icons'];
                    const missingFields = requiredFields.filter(field => !manifest[field]);
                    if (missingFields.length === 0) {
                        console.log('‚úÖ All required manifest fields present');
                    } else {
                        console.log('‚ùå Missing manifest fields:', missingFields);
                    }
                    
                    // Check icons
                    if (manifest.icons && manifest.icons.length > 0) {
                        console.log('‚úÖ Icons found:', manifest.icons.length);
                        manifest.icons.forEach((icon, index) => {
                            console.log(`Icon ${index + 1}:`, icon.sizes, icon.type);
                        });
                    } else {
                        console.log('‚ùå No icons found in manifest');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Failed to decode manifest:', error);
                }
            }
            
            // Show install readiness
            setTimeout(() => {
                const isReady = (location.protocol === 'https:' || location.hostname === 'localhost') && 
                               'serviceWorker' in navigator && 
                               document.querySelector('link[rel="manifest"]');
                               
                console.log(isReady ? '‚úÖ PWA Ready for installation' : '‚ùå PWA Not ready for installation');
                
                if (!isReady) {
                    console.log('PWA Requirements not met. Install button will show manual instructions.');
                }
            }, 1000);
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'996fcb7fe3f5fd3b',t:'MTc2MTg3ODUwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
